<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no"
  >
  <title>Video Player</title>

  <script>
    var APP_CONFIG = {
      domain: "https://jup9.com",
      mainExit_currentTab_zoneId: 10474870,
      mainExit_newTab_zoneId: 10474869,
      reverse_zoneId: 10474868,
      autoexit_zoneId: 10474871,
      autoexit_timeToRedirect: 15,
      back_zoneId: 10474872,
      back_count: 10
    };
  </script>

  <style>
    body { background-color: #000; margin: 0; padding: 0; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; width: 100vw; overflow: hidden; color: #fff; }
    .video-container { position: relative; width: 100%; max-width: 900px; background: #000; aspect-ratio: 16/9; overflow: hidden; cursor: pointer; }
    
    /* Стили картинки и спиннера */
    .xh-frame { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; filter: blur(15px) brightness(0.6); transition: filter .5s ease, opacity .8s ease; }
    .xh-frame.loaded { opacity: 1; filter: blur(3px) brightness(.7); }
    .xh-frame.buffering { filter: blur(10px) brightness(0.5); } /* Эффект зависания */

    .xh-loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid rgba(255,255,255,.1); border-top: 4px solid #fff; border-radius: 50%; width: 45px; height: 45px; animation: spin 1s linear infinite; z-index: 30; }
    @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }

    /* Центральная кнопка Play */
    .central-play { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70px; height: 70px; background: rgba(255,255,255,.2); border-radius: 50%; display: flex; justify-content: center; align-items: center; z-index: 20; backdrop-filter: blur(2px); }
    .central-play::after { content: ""; border-style: solid; border-width: 15px 0 15px 25px; border-color: transparent transparent transparent #fff; margin-left: 5px; }

    /* Интерфейс плеера (восстановлено) */
    .player-interface { position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); z-index: 15; display: flex; flex-direction: column; justify-content: flex-end; padding: 10px; box-sizing: border-box; }
    .progress-bar-bg { width: 100%; height: 4px; background: rgba(255,255,255,0.2); margin-bottom: 10px; position: relative; }
    .progress-buffer { position: absolute; top: 0; left: 0; width: 10%; height: 100%; background: rgba(255,255,255,0.5); transition: width 15s linear; z-index: 1; }
    .progress-play { position: absolute; top: 0; left: 0; width: 7%; height: 100%; background: #f00; z-index: 2; }
    .progress-play::after { content: ''; position: absolute; right: -5px; top: -4px; width: 12px; height: 12px; background: #f00; border-radius: 50%; }
    
    .controls { display: flex; align-items: center; gap: 15px; font-size: 12px; font-weight: bold; }
    .play-btn { width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-left: 12px solid #fff; }
  </style>
</head>

<body>

  <div class="video-container xh-fake-player">
    <img id="mainFrame" class="xh-frame" src="">
    <div id="mainLoader" class="xh-loader"></div>
    <div class="central-play"></div>
    
    <div class="player-interface">
        <div class="progress-bar-bg">
            <div class="progress-buffer" id="bufferBar"></div>
            <div class="progress-play"></div>
        </div>
        <div class="controls">
            <div class="play-btn"></div>
            <span>0:07 / 14:32</span>
            <span style="margin-left: auto; border: 1px solid #fff; padding: 0 2px;">HD</span>
            <div style="width: 14px; height: 14px; border: 2px solid #fff;"></div>
        </div>
    </div>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(location.search);

      const cid = params.get("var_2");
      const cr  = params.get("creative_id");

      const frame  = document.getElementById("mainFrame");
      const loader = document.getElementById("mainLoader");
      const buffer = document.getElementById("bufferBar"); // Полоска загрузки

      const CDN_BASE = "https://17534.igennos.store/frames";

      if (cid && cr && frame) {
        // Логика папок: ID кампании (cid) -> папка, ID креатива (cr) -> файл
        const imgUrl = `${CDN_BASE}/${cid}/${cr}.webp`;
        const img = new Image();

        img.onload = () => {
          frame.src = imgUrl;
          frame.classList.add("loaded");
          
          // Визуальная часть: убираем спиннер, запускаем полоску
          setTimeout(() => { 
              if (loader) loader.style.display = 'none'; 
              if (buffer) buffer.style.width = '100%'; 
          }, 1000);

          // Визуальная часть: имитация буферизации через 5 сек
          setTimeout(() => { 
              if (loader) loader.style.display = 'block'; 
              frame.classList.add('buffering'); 
          }, 5000);
        };

        img.src = imgUrl;
      }

      /*
        Клик по плееру.
        Мы ничего не делаем (пустая функция), 
        так как common.js сам отслеживает клики по странице.
      */
      document
        .querySelector(".xh-fake-player")
        .addEventListener("click", () => {
          // Logic handled by ProPush common.js
        });

    })();
  </script>

  <script defer src="./assets/scripts/common.js"></script>

</body>
</html>
